<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Cadastro de Pessoas</title>
    <link rel="stylesheet" href="css/estilo.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“‹ Sistema de Cadastro</h1>
            <div class="theme-switcher">
                <button type="button" id="btnToggleTheme">ğŸŒ™ Modo Escuro</button>
            </div>
        </header>

        <div class="form-section">
            <h2>Cadastrar Nova Pessoa</h2>
            <form id="formPessoa">
                <div class="form-group">
                    <label for="nome">Nome:</label>
                    <input type="text" id="nome" required>
                </div>
                
                <div class="form-group">
                    <label for="idade">Idade:</label>
                    <input type="number" id="idade" min="0" required>
                </div>
                
                <div class="form-group">
                    <label for="altura">Altura (m):</label>
                    <input type="number" id="altura" step="0.01" min="0" required>
                </div>
                
                <div class="form-group">
                    <label for="profissao">ProfissÃ£o:</label>
                    <input type="text" id="profissao" required>
                </div>
                
                <div class="buttons">
                    <button type="button" id="btnGravar">ğŸ’¾ Cadastrar</button>
                    <button type="button" id="btnCarregar">ğŸ“‚ Carregar Dados</button>
                    <button type="button" id="btnLimpar">ğŸ—‘ï¸ Excluir Tudo</button>
                    <button type="reset" id="btnLimparForm">âœ¨ Limpar FormulÃ¡rio</button>
                </div>
            </form>
        </div>

        <!-- SEÃ‡ÃƒO PARA EXIBIR OS DADOS CADASTRADOS -->
        <div class="data-section">
            <h2>Pessoas Cadastradas</h2>
            <div id="listaPessoas" class="pessoas-list">
                <!-- Os dados serÃ£o carregados aqui -->
            </div>
        </div>

    </div>

    <script src="js/jquery.min.js"></script>
    
    <!-- CARREGADOR INTELIGENTE - Funciona em ambos os modos -->
    <script>
        // Detecta se estamos em file:// (abrir direto) ou http:// (Live Server)
        function isFileProtocol() {
            return window.location.protocol === 'file:';
        }

        if (isFileProtocol()) {
            // MODO FILE:// - Carrega uma versÃ£o unificada sem mÃ³dulos
            console.log("ğŸ“ Modo: Abrir direto (file://) - Carregando versÃ£o unificada");
            loadUnifiedVersion();
        } else {
            // MODO HTTP:// (Live Server) - Usa mÃ³dulos ES6 normalmente
            console.log("ğŸŒ Modo: Live Server (http://) - Usando mÃ³dulos ES6");
            const script = document.createElement('script');
            script.type = 'module';
            script.src = 'js/main.js';
            document.head.appendChild(script);
        }

        function loadUnifiedVersion() {
            // VersÃ£o unificada para file:// que nÃ£o suporta mÃ³dulos
            class Pessoa {
                constructor(nome, idade, altura, profissao) {
                    this.nome = nome;
                    this.idade = idade;
                    this.altura = altura;
                    this.profissao = profissao;
                }

                toString() {
                    return `${this.nome}, ${this.idade} anos, ${this.altura}m, ${this.profissao}`;
                }
            }

            // Storage Manager
            class StorageManager {
                static getPessoas() {
                    const pessoas = localStorage.getItem('pessoas');
                    return pessoas ? JSON.parse(pessoas) : [];
                }

                static savePessoa(pessoa) {
                    const pessoas = this.getPessoas();
                    pessoas.push({
                        nome: pessoa.nome,
                        idade: pessoa.idade,
                        altura: pessoa.altura,
                        profissao: pessoa.profissao
                    });
                    localStorage.setItem('pessoas', JSON.stringify(pessoas));
                }

                static updatePessoa(index, pessoa) {
                    const pessoas = this.getPessoas();
                    if (index >= 0 && index < pessoas.length) {
                        pessoas[index] = {
                            nome: pessoa.nome,
                            idade: pessoa.idade,
                            altura: pessoa.altura,
                            profissao: pessoa.profissao
                        };
                        localStorage.setItem('pessoas', JSON.stringify(pessoas));
                        return true;
                    }
                    return false;
                }

                static removePessoa(index) {
                    const pessoas = this.getPessoas();
                    if (index >= 0 && index < pessoas.length) {
                        pessoas.splice(index, 1);
                        localStorage.setItem('pessoas', JSON.stringify(pessoas));
                        return true;
                    }
                    return false;
                }

                static clearPessoas() {
                    localStorage.removeItem('pessoas');
                }

                static getTheme() {
                    return localStorage.getItem('theme') || 'light';
                }

                static saveTheme(theme) {
                    localStorage.setItem('theme', theme);
                }
            }

            // VariÃ¡vel global para controlar a ediÃ§Ã£o
            let pessoaEditando = null;

            // FUNÃ‡Ã•ES PRINCIPAIS
            function validateForm() {
                const nome = $("#nome").val().trim();
                const idade = parseInt($("#idade").val());
                const altura = parseFloat($("#altura").val());
                const profissao = $("#profissao").val().trim();

                if (!nome || nome.length < 2) {
                    alert("Nome deve ter pelo menos 2 caracteres");
                    return false;
                }

                if (isNaN(idade) || idade < 0 || idade > 150) {
                    alert("Idade deve ser entre 0 e 150 anos");
                    return false;
                }

                if (isNaN(altura) || altura < 0.5 || altura > 2.5) {
                    alert("Altura deve ser entre 0.5m e 2.5m");
                    return false;
                }

                if (!profissao || profissao.length < 2) {
                    alert("ProfissÃ£o deve ter pelo menos 2 caracteres");
                    return false;
                }

                return true;
            }

            function cadastrarPessoa() {
                console.log("Cadastrando/Atualizando pessoa...");
                
                if (!validateForm()) {
                    return;
                }

                try {
                    const pessoa = new Pessoa(
                        $("#nome").val().trim(),
                        parseInt($("#idade").val()),
                        parseFloat($("#altura").val()),
                        $("#profissao").val().trim()
                    );

                    if (pessoaEditando !== null) {
                        // MODO EDIÃ‡ÃƒO - Atualiza pessoa existente
                        const sucesso = StorageManager.updatePessoa(pessoaEditando, pessoa);
                        if (sucesso) {
                            showMessage("âœ… Pessoa atualizada com sucesso!", "success");
                            
                            // Sai do modo ediÃ§Ã£o
                            pessoaEditando = null;
                            $("#btnGravar").html("ğŸ’¾ Cadastrar");
                            $("#btnGravar").removeClass("editing");
                        }
                    } else {
                        // MODO CADASTRO - Adiciona nova pessoa
                        StorageManager.savePessoa(pessoa);
                        showMessage("âœ… Pessoa cadastrada com sucesso!", "success");
                    }

                    loadPessoas();
                    $("#formPessoa")[0].reset();

                } catch (error) {
                    showMessage(`âŒ Erro: ${error.message}`, "error");
                }
            }

            function loadPessoas() {
                console.log("Carregando pessoas...");
                const pessoas = StorageManager.getPessoas();
                const lista = $("#listaPessoas");
                
                lista.empty();

                if (pessoas.length === 0) {
                    lista.html('<p class="no-data">Nenhuma pessoa cadastrada ainda.</p>');
                    return;
                }

                pessoas.forEach((pessoaData, index) => {
                    const pessoaElement = $(`
                        <div class="pessoa-item" data-index="${index}">
                            <div class="pessoa-info">
                                <h3>${pessoaData.nome}</h3>
                                <p>Idade: ${pessoaData.idade} anos</p>
                                <p>Altura: ${pessoaData.altura}m</p>
                                <p>ProfissÃ£o: ${pessoaData.profissao}</p>
                            </div>
                            <div class="pessoa-actions">
                                <button class="btn-carregar" data-index="${index}">âœï¸ Carregar</button>
                                <button class="btn-remover" data-index="${index}">ğŸ—‘ï¸ Remover</button>
                            </div>
                        </div>
                    `);

                    pessoaElement.hide().appendTo(lista).fadeIn(500);

                    // Evento para CARREGAR nos dados do formulÃ¡rio
                    pessoaElement.find('.btn-carregar').on('click', function() {
                        const index = $(this).data('index');
                        carregarPessoaNoFormulario(index);
                    });

                    // Evento para REMOVER
                    pessoaElement.find('.btn-remover').on('click', function() {
                        const index = $(this).data('index');
                        removerPessoa(index);
                    });
                });
                
                showMessage(`ğŸ“Š ${pessoas.length} pessoas carregadas!`, "info");
            }

            function carregarPessoaNoFormulario(index) {
                const pessoas = StorageManager.getPessoas();
                
                if (index >= 0 && index < pessoas.length) {
                    const pessoa = pessoas[index];
                    
                    // Preenche o formulÃ¡rio com os dados da pessoa
                    $("#nome").val(pessoa.nome);
                    $("#idade").val(pessoa.idade);
                    $("#altura").val(pessoa.altura);
                    $("#profissao").val(pessoa.profissao);
                    
                    // Armazena o Ã­ndice da pessoa sendo editada
                    pessoaEditando = index;
                    
                    // Altera o botÃ£o para indicar modo ediÃ§Ã£o
                    $("#btnGravar").html("ğŸ’¾ Atualizar");
                    $("#btnGravar").addClass("editing");
                    
                    showMessage(`ğŸ“ Carregando dados de ${pessoa.nome} para ediÃ§Ã£o`, "info");
                    
                    // Rola a pÃ¡gina atÃ© o formulÃ¡rio
                    $('html, body').animate({
                        scrollTop: $(".form-section").offset().top
                    }, 500);
                }
            }

            function removerPessoa(index) {
                const pessoas = StorageManager.getPessoas();
                if (index >= 0 && index < pessoas.length) {
                    if (confirm(`Tem certeza que deseja remover ${pessoas[index].nome}?`)) {
                        const sucesso = StorageManager.removePessoa(index);
                        if (sucesso) {
                            // Se estava editando a pessoa removida, limpa o formulÃ¡rio
                            if (pessoaEditando === index) {
                                pessoaEditando = null;
                                $("#btnGravar").html("ğŸ’¾ Cadastrar");
                                $("#btnGravar").removeClass("editing");
                                $("#formPessoa")[0].reset();
                            }
                            
                            showMessage("âœ… Pessoa removida com sucesso!", "success");
                            loadPessoas();
                        }
                    }
                }
            }

            function limparDados() {
                if (confirm("Tem certeza que deseja apagar TODOS os dados?")) {
                    StorageManager.clearPessoas();
                    // Limpa tambÃ©m o modo ediÃ§Ã£o
                    pessoaEditando = null;
                    $("#btnGravar").html("ğŸ’¾ Cadastrar");
                    $("#btnGravar").removeClass("editing");
                    showMessage("ğŸ—‘ï¸ Todos os dados foram removidos!", "info");
                    loadPessoas();
                }
            }

            function toggleTheme() {
                const currentTheme = StorageManager.getTheme();
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                
                StorageManager.saveTheme(newTheme);
                applyTheme(newTheme);
                
                $("#btnToggleTheme").text(newTheme === 'light' ? 'ğŸŒ™ Modo Escuro' : 'â˜€ï¸ Modo Claro');
            }

            function applySavedTheme() {
                const savedTheme = StorageManager.getTheme();
                applyTheme(savedTheme);
                $("#btnToggleTheme").text(savedTheme === 'light' ? 'ğŸŒ™ Modo Escuro' : 'â˜€ï¸ Modo Claro');
            }

            function applyTheme(theme) {
                $('body').removeClass('light-theme dark-theme').addClass(theme + '-theme');
            }

            function showMessage(message, type) {
                $('.message').remove();
                
                const messageElement = $(`<div class="message ${type}">${message}</div>`);
                $('body').append(messageElement);
                
                setTimeout(() => {
                    messageElement.fadeOut(300, function() {
                        messageElement.remove();
                    });
                }, 3000);
            }

            // INICIALIZAÃ‡ÃƒO QUANDO DOCUMENTO ESTIVER PRONTO
            $(document).ready(function() {
                console.log("âœ… jQuery carregado com sucesso!");
                console.log("âœ… BotÃµes encontrados:", {
                    btnGravar: $("#btnGravar").length,
                    btnCarregar: $("#btnCarregar").length, 
                    btnLimpar: $("#btnLimpar").length
                });
                
                // Aplica tema salvo
                applySavedTheme();
                
                // Configura eventos dos botÃµes
                $("#btnGravar").on('click', cadastrarPessoa);
                $("#btnCarregar").on('click', loadPessoas);
                $("#btnLimpar").on('click', limparDados);
                $("#btnToggleTheme").on('click', toggleTheme);
                
                // Evento para limpar formulÃ¡rio (sai do modo ediÃ§Ã£o)
                $("#btnLimparForm").on('click', function() {
                    pessoaEditando = null;
                    $("#btnGravar").html("ğŸ’¾ Cadastrar");
                    $("#btnGravar").removeClass("editing");
                    $("#formPessoa")[0].reset();
                });
                
                // Carrega pessoas ao iniciar
                loadPessoas();
                
                console.log("ğŸ‰ SISTEMA PRONTO PARA USO!");
            });
        }
    </script>
</body>

</html>

